name: ðŸ“£ Notify us
on:
  workflow_run:
    workflows: ['ðŸš€ Deploy']
    types:
      - completed

jobs:
  notifiy-success:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Send notification to Zoom channel
        uses: fjogeleit/http-request-action@v1
        with:
          url: '${{ secrets.ZOOM_DEPLOYMENT_ENDPOINT }}?format=full'
          method: 'POST'
          customHeaders: '{"Content-Type": "application/json", "Authorization": "${{ secrets.ZOOM_DEPLOYMENT_API_KEY }}" }'
          data: '{ "head": { "text": "âœ… Deployment succesful website" }, "body": [ {"type": "message", "text": ${{ toJSON( github.event.workflow_run.head_commit.message ) }} }, { "type": "message", "text": "See workflow run", "link": "${{ github.event.workflow_run.html_url }}" } ] }'

  notifiy-failure:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Send notification to Zoom channel
        uses: fjogeleit/http-request-action@v1
        with:
          url: '${{ secrets.ZOOM_DEPLOYMENT_ENDPOINT }}?format=full'
          method: 'POST'
          customHeaders: '{"Content-Type": "application/json", "Authorization": "${{ secrets.ZOOM_DEPLOYMENT_API_KEY }}" }'
          data: '{ "head": { "text": "ðŸš¨ Deployment failed website" }, "body": [ {"type": "message", "text": ${{ toJSON( github.event.workflow_run.head_commit.message ) }} }, { "type": "message", "text": "See workflow run", "link": "${{ github.event.workflow_run.html_url }}" } ] }'